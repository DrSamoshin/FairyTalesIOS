# FairyTales iOS - –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üéØ –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
- **–ö–†–ò–¢–ò–ß–ù–û**: –í—Å–µ –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–µ–º–µ–π–Ω—ã–º –∏ –¥–µ—Ç—Å–∫–∏–º (–≤–æ–∑—Ä–∞—Å—Ç 3-16 –ª–µ—Ç)
- –ò—Å–∫–ª—é—á–µ–Ω—ã: –Ω–∞—Å–∏–ª–∏–µ, —Å—Ç—Ä–∞—à–Ω—ã–µ —Å—Ü–µ–Ω—ã, —Å–º–µ—Ä—Ç—å, –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π —è–∑—ã–∫
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–≥–æ –ò–ò-–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –°–æ–±–ª—é–¥–µ–Ω–∏–µ COPPA –∏ GDPR —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- SwiftUI + MVVM —Å @Observable –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∏—Å—Ç–∏–Ω—ã –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (shared managers)
- Dependency injection —á–µ—Ä–µ–∑ SwiftUI Environment
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤: UI ‚Üí Services ‚Üí Network ‚Üí Models

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
FairyTales/
‚îú‚îÄ‚îÄ Models/              # –î–∞–Ω–Ω—ã–µ –∏ API –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ Services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ managers
‚îú‚îÄ‚îÄ Network/             # –°–µ—Ç–µ–≤–æ–π —Å–ª–æ–π
‚îú‚îÄ‚îÄ Components/          # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ Constants/           # –¶–≤–µ—Ç–∞, —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã  
‚îú‚îÄ‚îÄ Extensions/          # –†–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤
‚îú‚îÄ‚îÄ Localization/        # –í—Å–µ —Ñ–∞–π–ª—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ (.lproj)
‚îî‚îÄ‚îÄ Assets.xcassets/     # –†–µ—Å—É—Ä—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

## üó£Ô∏è –ü—Ä–∞–≤–∏–ª–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º

### –û–±—â–µ–Ω–∏–µ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–í–ê–ñ–ù–û**: –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å - –¢–û–õ–¨–ö–û –æ—Ç–≤–µ—á–∞—Ç—å, –ù–ï –ø–∏—Å–∞—Ç—å –∫–æ–¥
- –ü–∏—Å–∞—Ç—å –∫–æ–¥ –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ —è–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è: "–ø–∏—à–∏ –∫–æ–¥", "–¥–µ–ª–∞–π", "—Ä–µ–∞–ª–∏–∑—É–π"
- –°–Ω–∞—á–∞–ª–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ—Ç–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –í—Å–µ–≥–¥–∞ —É—Ç–æ—á–Ω—è—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è

### Swift –≤–µ—Ä—Å–∏—è –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏—á–∏
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ–¥–Ω–∏–µ Swift —Ñ–∏—á–∏** (Swift 6.0+)
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –Ω–æ–≤–µ–π—à–∏–µ iOS SDK –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ SwiftUI –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ API
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ Xcode –∏ iOS –≤–µ—Ä—Å–∏–∏

## üíª –ö–æ–¥-—Å—Ç–∞–π–ª

### Naming Conventions
```swift
// Managers - —Å—É—Ñ—Ñ–∏–∫—Å Manager
class AuthManager { }
class NetworkManager { }

// Services - —Å—É—Ñ—Ñ–∏–∫—Å Service  
class StoryService { }
class StoryStreamingService { }

// Screens - —Å—É—Ñ—Ñ–∏–∫—Å Screen
struct MainScreen: View { }
struct StoryCreatorScreen: View { }

// Models - –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
struct Story: Codable { }
struct StoryGenerateRequest: Codable { }
```

### SwiftUI Best Practices (Swift 6.0+)
```swift
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ @Observable –¥–ª—è –Ω–æ–≤—ã—Ö managers (Swift 5.9+)
@Observable
@MainActor
final class MyManager: Sendable {
    static let shared = MyManager()
    private init() {}
}

// ‚úÖ Environment injection (SwiftUI 4.0+)
struct MyView: View {
    @Environment(AuthManager.self) private var authManager
}

// ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
private struct Constants {
    static let cornerRadius: CGFloat = 16
    static let padding: CGFloat = 20
}

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–µ Swift 6.0 —Ñ–∏—á–∏:
// - Strict concurrency checking
// - Complete concurrency model
// - Enhanced pattern matching
// - Improved generics
```

## üåê –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

### –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–í–ê–ñ–ù–û**: –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–ª–∞–µ–º –¢–û–õ–¨–ö–û –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
- –ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏ –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ —è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ RU, ES, FR, DE –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
- –í—Å–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ `Localization/`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏: EN, RU, ES, FR, DE
- –ö–ª—é—á–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ snake_case

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
```swift
// ‚úÖ –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ - —Ç–æ–ª—å–∫–æ EN
Text("story_created_title".localized)
Button("generate_story".localized) { }

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ  
Text("Story Created")
```

### –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª–Ω—É—é –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é
- –¢–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —è–≤–Ω–æ —Å–∫–∞–∂–µ—Ç "–¥–æ–±–∞–≤—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é"
- –ü—Ä–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ —Ä–µ–ª–∏–∑—É
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

## üé® UI/UX Guidelines

### Design System
```swift
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ AppColors –∏ AppTypography
.foregroundColor(AppColors.primary)
.font(AppTypography.title)

// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
cornerRadius: 16
padding: 20, 30
buttonHeight: 54
```

### –ê–Ω–∏–º–∞—Ü–∏–∏
```swift
// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏
.animation(.easeInOut(duration: 0.3), value: isVisible)
.transition(.asymmetric(insertion: .slide, removal: .opacity))
```

### –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞: `.preferredColorScheme(.dark)`
- –í—Å–µ —Ü–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ AppColors –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢–æ–∫–µ–Ω—ã –∏ —Å–µ–∫—Ä–µ—Ç—ã
```swift
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ TokenManager –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
let headers = tokenManager.authHeaders

// ‚úÖ Keychain –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
// ‚ùå –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω—ã –∏–ª–∏ –ø–∞—Ä–æ–ª–∏
```

### Network Security
- –¢–æ–ª—å–∫–æ HTTPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- Certificate pinning (—á–µ—Ä–µ–∑ CustomURLSessionDelegate)
- Proper error handling –±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## üì± –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Memory Management
```swift
// ‚úÖ Weak references –≤ closures
NotificationCenter.default.addObserver(forName: .name) { [weak self] _ in }

// ‚úÖ @MainActor –¥–ª—è UI updates
@MainActor
func updateUI() { }
```

### Networking
```swift
// ‚úÖ Proper timeouts
config.timeoutIntervalForRequest = 30
config.timeoutIntervalForResource = 60

// ‚úÖ Cache validation
private let cacheValidityPeriod: TimeInterval = 300 // 5 minutes
```

## üêõ Error Handling

### Network Errors
```swift
// ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
enum NetworkError: Error, LocalizedError {
    case apiError(ErrorResponse)
    case timeout
    case internetConnection
}
```

### User-Friendly Messages
```swift
// ‚úÖ –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
errorMessage = "auth_timeout_message".localized

// ‚úÖ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Ä–µ—à–µ–Ω–∏—é
"server_error_suggestion".localized
```

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```swift
// ‚úÖ Production - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏
// ‚úÖ Debug - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Ç–æ–ª—å–∫–æ –≤ development
// ‚ùå –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

#if DEBUG
print("Debug info: \(details)")
#endif
```

## üîÑ Streaming

### SSE Implementation
```swift
// ‚úÖ Proper delegate pattern
protocol StoryStreamingDelegate: AnyObject {
    nonisolated func streamingDidReceiveContent(_ content: String)
}

// ‚úÖ Background queue processing
private let bufferQueue = DispatchQueue(label: "buffer.queue")
```

## üí≥ –ü–æ–¥–ø–∏—Å–∫–∏ (StoreKit)

### Best Practices
```swift
// ‚úÖ Transaction validation
for await result in Transaction.updates {
    if case .verified(let transaction) = result {
        // Process verified transaction
    }
}

// ‚úÖ Status caching
private let cacheValidityPeriod: TimeInterval = 300
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit Tests
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ Services
- –ú–æ–∫–∞–π—Ç–µ network calls
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ edge cases

### UI Tests  
- –û—Å–Ω–æ–≤–Ω—ã–µ user flows
- Accessibility —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è UI

## üöÄ Deployment

### Pre-Release Checklist
- [ ] –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –ù–µ—Ç debug –ø—Ä–∏–Ω—Ç–æ–≤ –≤ production –∫–æ–¥–µ
- [ ] App Store guidelines —Å–æ–±–ª—é–¥–µ–Ω—ã
- [ ] Privacy policy –∞–∫—Ç—É–∞–ª—å–Ω–∞
- [ ] Subscription flow –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω

### Version Management
```swift
// Semantic versioning: MAJOR.MINOR.PATCH
// 1.0.0 - Major release
// 1.1.0 - New features  
// 1.1.1 - Bug fixes
```

## ‚ö†Ô∏è –ó–∞–ø—Ä–µ—Ç—ã

### –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–µ–ª–∞—Ç—å:
- ‚ùå –•–∞—Ä–¥–∫–æ–¥–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚ùå –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏, –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å main thread –¥–ª–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- ‚ùå –°–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–ª—è –¥–µ—Ç–µ–π
- ‚ùå –ö–æ–º–º–∏—Ç–∏—Ç—å –≤ main –±–µ–∑ code review
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å deprecated APIs –±–µ–∑ –≤–µ—Å–∫–æ–π –ø—Ä–∏—á–∏–Ω—ã

### –û—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å:
- ‚ö†Ô∏è Force unwrapping (!), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ guard/if let
- ‚ö†Ô∏è Retain cycles –≤ closures
- ‚ö†Ô∏è Network calls –≤ init –º–µ—Ç–æ–¥–∞—Ö
- ‚ö†Ô∏è Blocking UI –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏

## üìù Code Review

### –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ–≤—å—é–≤–µ—Ä–∞:
- [ ] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
- [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ –∏–ª–∏ retain cycles  
- [ ] Proper error handling
- [ ] UI responsive –∏ accessible
- [ ] –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –ù–µ—Ç –¥–µ—Ç—Å–∫–æ–≥–æ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- [ ] Performance implications —É—á—Ç–µ–Ω—ã

---

*–≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å FairyTales –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.*